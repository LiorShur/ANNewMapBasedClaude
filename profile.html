<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile - Accessible</title>
  <meta name="theme-color" content="#1a1a1a">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="manifest" href="manifest.json">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="src/css/global-nav.css">
  <script>
    (function() {
      try {
        var prefs = JSON.parse(localStorage.getItem('accessNature_displayPrefs') || '{}');
        if (prefs.highContrast) document.documentElement.classList.add('high-contrast');
      } catch(e) {}
    })();
  </script>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    :root{--bg-primary:#1a1a1a;--bg-secondary:#242424;--bg-tertiary:#2d2d2d;--text-primary:#fff;--text-secondary:rgba(255,255,255,.7);--text-muted:rgba(255,255,255,.5);--border-color:rgba(255,255,255,.1);--accent-trails:#4CAF50;--accent-urban:#FF9800;--accent-blue:#2196F3}
    body{font-family:'DM Sans',-apple-system,sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh;padding-bottom:80px}
    .visually-hidden{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
    button:focus-visible,a:focus-visible,input:focus-visible{outline:3px solid var(--accent-trails);outline-offset:2px}
    .top-bar{position:fixed;top:0;left:0;right:0;height:56px;background:rgba(26,26,26,.95);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:center;z-index:1000;border-bottom:1px solid var(--border-color)}
    .top-bar-brand{font-size:1.125rem;font-weight:600;display:flex;align-items:center;gap:8px}
    .profile-content{padding:72px 16px 24px;max-width:600px;margin:0 auto}
    .profile-header{text-align:center;margin-bottom:32px}
    .profile-avatar{width:100px;height:100px;background:linear-gradient(135deg,var(--accent-trails) 0%,#2e7d32 100%);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:2.5rem;margin:0 auto 16px;border:4px solid var(--bg-secondary);box-shadow:0 4px 20px rgba(76,175,80,.3)}
    .profile-name{font-size:1.5rem;font-weight:700;margin-bottom:4px}
    .profile-email{color:var(--text-muted);font-size:.9rem;margin-bottom:8px}
    .profile-badge{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;background:rgba(76,175,80,.15);border:1px solid rgba(76,175,80,.3);border-radius:20px;color:var(--accent-trails);font-size:.85rem;font-weight:600}
    .stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:32px}
    .stat-card{background:var(--bg-secondary);border-radius:16px;padding:20px 12px;text-align:center;border:1px solid var(--border-color)}
    .stat-value{font-size:1.75rem;font-weight:700;margin-bottom:4px}
    .stat-value.green{color:var(--accent-trails)}.stat-value.orange{color:var(--accent-urban)}.stat-value.blue{color:var(--accent-blue)}
    .stat-label{font-size:.75rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px}
    .section{margin-bottom:24px}
    .section-title{font-size:.85rem;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:12px;padding-left:4px}
    .menu-list{background:var(--bg-secondary);border-radius:16px;overflow:hidden;border:1px solid var(--border-color)}
    .menu-item{display:flex;align-items:center;gap:14px;padding:16px;color:var(--text-primary);text-decoration:none;border-bottom:1px solid var(--border-color);transition:background .2s;cursor:pointer;background:none;border-left:none;border-right:none;border-top:none;width:100%;font-size:1rem;font-family:inherit;text-align:left}
    .menu-item:last-child{border-bottom:none}
    .menu-item:hover{background:var(--bg-tertiary)}
    .menu-icon{width:40px;height:40px;background:var(--bg-tertiary);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.25rem;flex-shrink:0}
    .menu-text{flex:1}
    .menu-text-title{font-weight:600;margin-bottom:2px}
    .menu-text-desc{font-size:.85rem;color:var(--text-muted)}
    .menu-arrow{color:var(--text-muted);font-size:1.25rem}
    .toggle-switch{position:relative;width:50px;height:28px;background:var(--bg-tertiary);border-radius:14px;cursor:pointer;transition:background .3s}
    .toggle-switch.active{background:var(--accent-trails)}
    .toggle-switch::after{content:'';position:absolute;top:3px;left:3px;width:22px;height:22px;background:#fff;border-radius:50%;transition:transform .3s}
    .toggle-switch.active::after{transform:translateX(22px)}
    .achievements-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    .achievement{background:var(--bg-secondary);border-radius:12px;padding:16px 8px;text-align:center;border:1px solid var(--border-color);transition:all .2s}
    .achievement.locked{opacity:.4}
    .achievement-icon{font-size:2rem;margin-bottom:8px}
    .achievement-name{font-size:.7rem;font-weight:600;color:var(--text-secondary)}
    .activity-list{background:var(--bg-secondary);border-radius:16px;overflow:hidden;border:1px solid var(--border-color)}
    .activity-item{display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid var(--border-color)}
    .activity-item:last-child{border-bottom:none}
    .activity-icon{width:36px;height:36px;background:var(--bg-tertiary);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0}
    .activity-icon.trail{background:rgba(76,175,80,.15)}
    .activity-icon.report{background:rgba(255,152,0,.15)}
    .activity-content{flex:1;min-width:0}
    .activity-title{font-weight:600;font-size:.95rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .activity-meta{font-size:.8rem;color:var(--text-muted)}
    .signout-btn{width:100%;padding:16px;background:transparent;border:1px solid rgba(244,67,54,.3);border-radius:12px;color:#f44336;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s;margin-top:16px}
    .signout-btn:hover{background:rgba(244,67,54,.1);border-color:#f44336}
    .not-signed-in{text-align:center;padding:60px 20px}
    .not-signed-in-icon{font-size:4rem;margin-bottom:16px}
    .not-signed-in h2{font-size:1.5rem;margin-bottom:8px}
    .not-signed-in p{color:var(--text-muted);margin-bottom:24px}
    .signin-btn{display:inline-flex;align-items:center;gap:8px;padding:14px 32px;background:var(--accent-trails);color:#fff;border:none;border-radius:12px;font-size:1rem;font-weight:600;cursor:pointer;transition:all .2s}
    .signin-btn:hover{background:#43a047;transform:scale(1.02)}
    .toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%) translateY(100px);background:rgba(26,26,26,.95);color:#fff;padding:12px 24px;border-radius:25px;font-size:14px;font-weight:500;z-index:2000;opacity:0;transition:all .3s}
    .toast.show{transform:translateX(-50%) translateY(0);opacity:1}
    .toast.success{background:rgba(76,175,80,.95)}.toast.error{background:rgba(244,67,54,.95)}
    .loading{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px}
    .loading-spinner{width:48px;height:48px;border:4px solid var(--border-color);border-top-color:var(--accent-trails);border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .loading-text{margin-top:16px;color:var(--text-secondary)}
    .modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:10000;opacity:0;pointer-events:none;transition:opacity .3s}
    .modal-overlay.open{opacity:1;pointer-events:auto}
  </style>
</head>
<body>
  <h1 class="visually-hidden">My Profile</h1>
  <header class="top-bar"><div class="top-bar-brand"><span>‚ôø</span><span>Accessible</span></div></header>
  <main class="profile-content">
    <div class="loading" id="loadingState"><div class="loading-spinner"></div><p class="loading-text">Loading profile...</p></div>
    <div class="not-signed-in" id="notSignedInState" style="display:none">
      <div class="not-signed-in-icon">üë§</div>
      <h2>Welcome to Accessible</h2>
      <p>Sign in to track your contributions and earn achievements</p>
      <button class="signin-btn" onclick="openAuthModal()">Sign In</button>
    </div>
    <div id="signedInContent" style="display:none">
      <div class="profile-header">
        <div class="profile-avatar" id="profileAvatar">üë§</div>
        <div class="profile-name" id="profileName">User</div>
        <div class="profile-email" id="profileEmail">user@example.com</div>
        <div class="profile-badge"><span>üå±</span><span id="profileLevel">Trail Explorer</span></div>
      </div>
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-value green" id="trailsRecorded">0</div><div class="stat-label">Trails</div></div>
        <div class="stat-card"><div class="stat-value orange" id="reportsSubmitted">0</div><div class="stat-label">Reports</div></div>
        <div class="stat-card"><div class="stat-value blue" id="totalKm">0</div><div class="stat-label">km Mapped</div></div>
      </div>
      <div class="section">
        <div class="section-title">Achievements</div>
        <div class="achievements-grid">
          <div class="achievement locked" id="achFirstTrail"><div class="achievement-icon">ü•æ</div><div class="achievement-name">First Trail</div></div>
          <div class="achievement locked" id="achExplorer"><div class="achievement-icon">üó∫Ô∏è</div><div class="achievement-name">Explorer</div></div>
          <div class="achievement locked" id="achReporter"><div class="achievement-icon">üìù</div><div class="achievement-name">Reporter</div></div>
          <div class="achievement locked" id="achChampion"><div class="achievement-icon">üèÜ</div><div class="achievement-name">Champion</div></div>
        </div>
      </div>
      <div class="section">
        <div class="section-title">Recent Activity</div>
        <div class="activity-list" id="activityList">
          <div class="activity-item"><div class="activity-icon trail">ü•æ</div><div class="activity-content"><div class="activity-title">No recent activity</div><div class="activity-meta">Start recording trails or submitting reports</div></div></div>
        </div>
      </div>
      <div class="section">
        <div class="section-title">Settings</div>
        <div class="menu-list">
          <button class="menu-item" onclick="toggleHighContrast()"><div class="menu-icon">üî≤</div><div class="menu-text"><div class="menu-text-title">High Contrast</div><div class="menu-text-desc">Improve visibility</div></div><div class="toggle-switch" id="highContrastToggle"></div></button>
          <a href="beta-guide.html" class="menu-item"><div class="menu-icon">üìñ</div><div class="menu-text"><div class="menu-text-title">User Guide</div><div class="menu-text-desc">Learn how to use the app</div></div><span class="menu-arrow">‚Ä∫</span></a>
          <a href="privacy.html" class="menu-item"><div class="menu-icon">üîí</div><div class="menu-text"><div class="menu-text-title">Privacy Policy</div><div class="menu-text-desc">How we handle your data</div></div><span class="menu-arrow">‚Ä∫</span></a>
          <a href="terms.html" class="menu-item"><div class="menu-icon">üìú</div><div class="menu-text"><div class="menu-text-title">Terms of Service</div><div class="menu-text-desc">Usage terms</div></div><span class="menu-arrow">‚Ä∫</span></a>
        </div>
      </div>
      <button class="signout-btn" onclick="signOut()">Sign Out</button>
    </div>
  </main>
  <div id="toast" class="toast"></div>
  <div class="modal-overlay" id="authModal">
    <div style="background:var(--bg-primary);border-radius:24px;width:100%;max-width:400px;margin:20px;border:1px solid var(--border-color)">
      <div style="padding:20px;border-bottom:1px solid var(--border-color);display:flex;justify-content:space-between;align-items:center">
        <h2 style="font-size:1.25rem;margin:0">Welcome</h2>
        <button onclick="closeAuthModal()" style="width:40px;height:40px;border:none;background:var(--bg-tertiary);border-radius:50%;font-size:1.5rem;color:var(--text-secondary);cursor:pointer">√ó</button>
      </div>
      <div style="padding:20px">
        <div id="loginView">
          <p style="text-align:center;margin-bottom:24px;color:var(--text-secondary)">Sign in to continue</p>
          <form id="loginFormElement" onsubmit="handleLogin(event)">
            <div style="margin-bottom:12px"><input type="email" id="loginEmail" placeholder="Email address" required style="width:100%;padding:14px 16px;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:12px;color:var(--text-primary);font-size:1rem"></div>
            <div style="margin-bottom:12px"><input type="password" id="loginPassword" placeholder="Password" required style="width:100%;padding:14px 16px;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:12px;color:var(--text-primary);font-size:1rem"></div>
            <button type="submit" style="width:100%;padding:14px;background:var(--accent-trails);color:#fff;border:none;border-radius:12px;font-size:1rem;font-weight:600;cursor:pointer">Sign In</button>
          </form>
          <p style="text-align:center;margin-top:20px;color:var(--text-muted)">No account? <button type="button" onclick="showSignup()" style="background:none;border:none;color:var(--accent-trails);cursor:pointer;font-weight:600">Sign up</button></p>
        </div>
        <div id="signupView" style="display:none">
          <p style="text-align:center;margin-bottom:24px;color:var(--text-secondary)">Create your account</p>
          <form id="signupFormElement" onsubmit="handleSignup(event)">
            <div style="margin-bottom:12px"><input type="text" id="signupName" placeholder="Your name" required style="width:100%;padding:14px 16px;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:12px;color:var(--text-primary);font-size:1rem"></div>
            <div style="margin-bottom:12px"><input type="email" id="signupEmail" placeholder="Email address" required style="width:100%;padding:14px 16px;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:12px;color:var(--text-primary);font-size:1rem"></div>
            <div style="margin-bottom:12px"><input type="password" id="signupPassword" placeholder="Create password" required style="width:100%;padding:14px 16px;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:12px;color:var(--text-primary);font-size:1rem"></div>
            <button type="submit" style="width:100%;padding:14px;background:var(--accent-trails);color:#fff;border:none;border-radius:12px;font-size:1rem;font-weight:600;cursor:pointer">Create Account</button>
          </form>
          <p style="text-align:center;margin-top:20px;color:var(--text-muted)">Have account? <button type="button" onclick="showLogin()" style="background:none;border:none;color:var(--accent-trails);cursor:pointer;font-weight:600">Sign in</button></p>
        </div>
      </div>
    </div>
  </div>
  <script type="module">
    import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut as firebaseSignOut, updateProfile } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js";
    import { getFirestore, collection, query, where, getDocs, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";
    const firebaseConfig={apiKey:"AIzaSyAmsm916Lzp0MUXANq3SECO4ec7q1H0Vu4",authDomain:"accessnaturebeta-821a2.firebaseapp.com",projectId:"accessnaturebeta-821a2",storageBucket:"accessnaturebeta-821a2.appspot.com",messagingSenderId:"670888101781",appId:"1:670888101781:web:b4cf57f58e86182466589c"};
    let app=getApps().length===0?initializeApp(firebaseConfig):getApp();const auth=getAuth(app);const db=getFirestore(app);window.auth=auth;window.db=db;
    onAuthStateChanged(auth,async(user)=>{document.getElementById('loadingState').style.display='none';if(user&&!user.isAnonymous){document.getElementById('notSignedInState').style.display='none';document.getElementById('signedInContent').style.display='block';const name=user.displayName||user.email?.split('@')[0]||'User';document.getElementById('profileName').textContent=name;document.getElementById('profileEmail').textContent=user.email;document.getElementById('profileAvatar').textContent=name.charAt(0).toUpperCase();await loadUserStats(user.uid);await loadRecentActivity(user.uid);}else{document.getElementById('notSignedInState').style.display='block';document.getElementById('signedInContent').style.display='none';}});
    async function loadUserStats(userId){try{const trailsQuery=query(collection(db,'trail_guides'),where('userId','==',userId));const trailsSnap=await getDocs(trailsQuery);let totalDistance=0;trailsSnap.forEach(doc=>{const data=doc.data();if(data.totalDistance)totalDistance+=data.totalDistance;});document.getElementById('trailsRecorded').textContent=trailsSnap.size;document.getElementById('totalKm').textContent=(totalDistance/1000).toFixed(1);const reportsQuery=query(collection(db,'accessibility_reports'),where('userId','==',userId));const reportsSnap=await getDocs(reportsQuery);document.getElementById('reportsSubmitted').textContent=reportsSnap.size;if(trailsSnap.size>=1)document.getElementById('achFirstTrail').classList.remove('locked');if(trailsSnap.size>=5)document.getElementById('achExplorer').classList.remove('locked');if(reportsSnap.size>=1)document.getElementById('achReporter').classList.remove('locked');if(trailsSnap.size>=10&&reportsSnap.size>=10)document.getElementById('achChampion').classList.remove('locked');const total=trailsSnap.size+reportsSnap.size;let level='Trail Explorer';if(total>=20)level='Accessibility Champion';else if(total>=10)level='Community Leader';else if(total>=5)level='Active Contributor';document.getElementById('profileLevel').textContent=level;}catch(error){console.error('Error loading stats:',error);}}
    async function loadRecentActivity(userId){try{const activityList=document.getElementById('activityList');const activities=[];const trailsQuery=query(collection(db,'trail_guides'),where('userId','==',userId),orderBy('createdAt','desc'),limit(3));const trailsSnap=await getDocs(trailsQuery);trailsSnap.forEach(doc=>{const data=doc.data();activities.push({type:'trail',title:data.trailName||'Unnamed Trail',date:data.createdAt?.toDate()||new Date(),icon:'ü•æ'});});const reportsQuery=query(collection(db,'accessibility_reports'),where('userId','==',userId),orderBy('createdAt','desc'),limit(3));const reportsSnap=await getDocs(reportsQuery);reportsSnap.forEach(doc=>{const data=doc.data();activities.push({type:'report',title:data.title||'Unnamed Report',date:data.createdAt?.toDate()||new Date(),icon:'üìù'});});activities.sort((a,b)=>b.date-a.date);if(activities.length>0){activityList.innerHTML=activities.slice(0,5).map(a=>`<div class="activity-item"><div class="activity-icon ${a.type}">${a.icon}</div><div class="activity-content"><div class="activity-title">${a.title}</div><div class="activity-meta">${formatDate(a.date)}</div></div></div>`).join('');}}catch(error){console.error('Error loading activity:',error);}}
    function formatDate(date){const now=new Date();const diff=now-date;const days=Math.floor(diff/(1000*60*60*24));if(days===0)return'Today';if(days===1)return'Yesterday';if(days<7)return`${days} days ago`;return date.toLocaleDateString();}
    window.handleLogin=async(e)=>{e.preventDefault();const email=document.getElementById('loginEmail').value;const password=document.getElementById('loginPassword').value;try{await signInWithEmailAndPassword(auth,email,password);closeAuthModal();showToast('Signed in successfully','success');}catch(error){showToast(error.message,'error');}};
    window.handleSignup=async(e)=>{e.preventDefault();const name=document.getElementById('signupName').value;const email=document.getElementById('signupEmail').value;const password=document.getElementById('signupPassword').value;try{const result=await createUserWithEmailAndPassword(auth,email,password);await updateProfile(result.user,{displayName:name});closeAuthModal();showToast('Account created!','success');}catch(error){showToast(error.message,'error');}};
    window.signOut=async()=>{try{await firebaseSignOut(auth);showToast('Signed out');}catch(error){showToast(error.message,'error');}};
    window.showLogin=()=>{document.getElementById('loginView').style.display='block';document.getElementById('signupView').style.display='none';};
    window.showSignup=()=>{document.getElementById('loginView').style.display='none';document.getElementById('signupView').style.display='block';};
  </script>
  <script>
    function openAuthModal(){document.getElementById('authModal').classList.add('open');}
    function closeAuthModal(){document.getElementById('authModal').classList.remove('open');}
    window.openAuthModal=openAuthModal;window.closeAuthModal=closeAuthModal;
    function toggleHighContrast(){const toggle=document.getElementById('highContrastToggle');const isActive=toggle.classList.toggle('active');if(isActive)document.documentElement.classList.add('high-contrast');else document.documentElement.classList.remove('high-contrast');try{const prefs=JSON.parse(localStorage.getItem('accessNature_displayPrefs')||'{}');prefs.highContrast=isActive;localStorage.setItem('accessNature_displayPrefs',JSON.stringify(prefs));}catch(e){}showToast(isActive?'High contrast enabled':'High contrast disabled');}
    document.addEventListener('DOMContentLoaded',()=>{try{const prefs=JSON.parse(localStorage.getItem('accessNature_displayPrefs')||'{}');if(prefs.highContrast)document.getElementById('highContrastToggle').classList.add('active');}catch(e){}});
    window.toggleHighContrast=toggleHighContrast;
    function showToast(msg,type=''){const t=document.getElementById('toast');t.textContent=msg;t.className='toast show '+type;setTimeout(()=>t.classList.remove('show'),3000);}
    window.showToast=showToast;
  </script>
  <script type="module">import{initGlobalNav}from'./src/components/globalNav.js';initGlobalNav({currentPage:'profile'});</script>
</body>
</html>
